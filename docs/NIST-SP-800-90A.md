# NIST SP 800-90A AES-CTR-DRBG: Specification Mapping

| NIST SP 800-90A Requirement                                                                 | Implementation Reference                                   | Construction Step                                                                                           |
|---------------------------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
| **1. Instantiate: Acquire entropy and set initial state (`Key` and `V`)**                   | `newDRBG()` uses `io.ReadFull(rand.Reader, ...)`          | - Entropy input of `KeySize + 16` bytes is split into key and counter (V)                                  |
|                                                                                             |                                                           | - Personalization string (if provided) XORs into seed                                                      |
|                                                                                             |                                                           | - AES cipher constructed using key                                                                         |
|                                                                                             |                                                           | - Initial counter (V) set from entropy                                                                     |
| **2. Generate: For each output block, increment counter and encrypt**                        | `fillBlocks()` with `incV(v)` and `st.block.Encrypt(...)` | - For each 16-byte output block:                                                                           |
|                                                                                             |                                                           |   - Increment counter (V) (big-endian)                                                                     |
|                                                                                             |                                                           |   - Encrypt V using AES-CTR (AES block cipher in counter mode)                                             |
|                                                                                             |                                                           |   - Write result to output buffer                                                                          |
| **3. Update State After Generation**                                                        | `Read()` and `fillBlocks()` copy updated counter to state | - After output, updated counter (V) is copied back to DRBG instance                                        |
|                                                                                             |                                                           | - Mutex ensures exclusive access to counter                                                                |
| **4. Rekey/Reseed (Optional/Configurable):**                                                | `asyncRekey()` and usage logic                            | - Supports automatic rekeying after configurable number of bytes generated (`MaxBytesPerKey`)               |
|                                                                                             |                                                           | - New entropy acquired for new key and V                                                                   |
|                                                                                             |                                                           | - State atomically swapped; usage counter reset                                                            |
| **5. Personalization Support (Optional):**                                                  | `newDRBG()` and rekey use personalization                 | - Personalization string incorporated at instantiation and rekey                                            |
| **6. Edge Cases and Robustness:**                                                           | Test suite; zero/overflow logic                           | - Zero-length reads are no-ops                                                                             |
|                                                                                             |                                                           | - Counter overflow (wrap) is supported                                                                     |
|                                                                                             |                                                           | - Large and unaligned read sizes are supported                                                             |
| **7. Error Handling:**                                                                      | Error returns/panics for entropy/cipher errors            | - Instantiation returns error or panics if entropy/cipher initialization fails                             |
|                                                                                             |                                                           | - Rekey silently continues with prior state if entropy is unavailable                                      |
| **8. Concurrency:**                                                                         | Mutexes and per-instance state                            | - Mutex on counter ensures thread safety per DRBG instance                                                 |
|                                                                                             |                                                           | - Pooling enables concurrent DRBG use                                                                      |
| **9. Interface and Integration:**                                                           | `io.Reader` interface                                     | - DRBG implements `io.Reader` for use with standard Go APIs                                                |
| **10. No External Dependencies:**                                                           | Go standard library only                                  | - Implementation relies solely on standard Go cryptography primitives                                      |
